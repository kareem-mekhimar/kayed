{"version":3,"sources":["../../src/services/auction-worker.js"],"names":["start","scheduleJob","auctions","find","finished","auction","endDate","Date","findOne","sort","price","limit","auctionOffer","console","log","_id","save"],"mappings":";;;;;QAMgBA,K,GAAAA,K;;AANhB;;;;AAEA;;;;AACA;;;;;;;;AAGO,SAASA,KAAT,GAAiB;AAAA;;AAEhB,+BAASC,WAAT,CAAqB,aAArB,0DAAoC;AAAA;AAAA;AAAA;AAAA;AAAA;AACxBC,wDADwB,GACb,kBAAQC,IAAR,CAAa,EAAEC,UAAS,KAAX,EAAb,CADa;AAAA,sFAGTF,QAHS;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAGpBG,uDAHoB;AAKhBC,uDALgB,GAKND,QAAQC,OALF;;AAAA,sDAOjB,IAAIC,IAAJ,KAAaD,OAPI;AAAA;AAAA;AAAA;;AAAA;AAAA,uDAQa,uBAAaE,OAAb,CAAqB,EAArB,EAAyBC,IAAzB,CAA8B,EAAEC,OAAO,CAAC,CAAV,EAA9B,EAA6CC,KAA7C,CAAmD,CAAnD,CARb;;AAAA;AAQRC,4DARQ;;;AAUZC,wDAAQC,GAAR,CAAYF,YAAZ;;AAEA,oDAAGA,YAAH,EAAgB;AACRP,gEAAQO,YAAR,GAAuBA,aAAaG,GAApC;AACP;;AAEDV,wDAAQD,QAAR,GAAmB,IAAnB;AACAC,wDAAQW,IAAR;;AAjBY;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAApC;AAuBP","file":"auction-worker.js","sourcesContent":["import schedule from \"node-schedule\" ;\n\nimport Auction from \"../models/auction.model\";\nimport AuctionOffer from \"../models/auction-offer.model\";\n\n\nexport function start() {\n        \n        schedule.scheduleJob('0 0 0 * * *', async () => {\n                let auctions = Auction.find({ finished:false }) ;\n                \n                for(let auction in auctions){\n                 \n                        let endDate = auction.endDate ;\n                \n                        if(new Date() > endDate){\n                                let auctionOffer = await AuctionOffer.findOne({}).sort({ price: -1 }).limit(1)\n                                \n                                console.log(auctionOffer) ;\n                                \n                                if(auctionOffer){\n                                        auction.auctionOffer = auctionOffer._id\n                                }\n\n                                auction.finished = true ;\n                                auction.save() ;\n                        }\n                }\n                         \n        });\n\n}"]}