{"version":3,"sources":["../../src/controllers/search.controller.js"],"names":["search","req","res","next","q","query","send","barters","auctions","$text","$search","find","populate","sort","creationDate","limit","status"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AAEA;;;;;;kBAEe;AACLA,UADK,kBACEC,GADF,EACOC,GADP,EACYC,IADZ,EACkB;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACnBC,6BADmB,GACbH,IAAII,KADS,CACnBD,CADmB;;AAEzB,gCAAI,CAACA,CAAL,EAAQ;AACJF,oCAAII,IAAJ,CAAS,EAAEC,SAAS,EAAX,EAAgBC,UAAU,EAA1B,EAAT;AACH;;AAEGH,iCANqB,GAMb;AACRI,uCAAO,EAAEC,SAASN,CAAX;AADC,6BANa;AAAA;AAAA;AAAA,mCAWD,iBAAOO,IAAP,CAAYN,KAAZ,EACKO,QADL,CACc,6BADd,EAEKC,IAFL,CAEU,EAAEC,cAAc,CAAC,CAAjB,EAFV,EAGKC,KAHL,CAGW,EAHX,CAXC;;AAAA;AAWjBR,mCAXiB;AAAA;AAAA,mCAgBA,kBAAQI,IAAR,CAAaN,KAAb,EACIO,QADJ,CACa,6BADb,EAEIC,IAFJ,CAES,EAAEC,cAAc,CAAC,CAAjB,EAFT,EAGIC,KAHJ,CAGU,EAHV,CAhBA;;AAAA;AAgBjBP,oCAhBiB;AAAA;AAAA,mCAqBL,wDAA8BD,OAA9B,EAAuCN,GAAvC,EAA4C,IAA5C,CArBK;;AAAA;AAqBrBM,mCArBqB;AAAA;AAAA,mCAsBJ,wDAA8BC,QAA9B,EAAwCP,GAAxC,EAA6C,KAA7C,CAtBI;;AAAA;AAsBrBO,oCAtBqB;;;AAwBrBN,gCAAIc,MAAJ,CAAW,GAAX,EAAgBV,IAAhB,CAAqB,EAAEC,gBAAF,EAAYC,kBAAZ,EAArB;;AAxBqB;AAAA;;AAAA;AAAA;AAAA;;AA2BrBL;;AA3BqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA8B5B;AA/BU,C","file":"search.controller.js","sourcesContent":["import mongoose from \"mongoose\" ;\nimport Barter from \"../models/barter.model\";\nimport Auction from \"../models/auction.model\";\n\nimport { checkAllMyOfferAndFavouriteIn } from \"../helpers/Barter&AuctionHelper\";\n\nexport default {\n    async search(req, res, next) {\n        let { q } = req.query;\n        if (!q) {\n            res.send({ barters: [] , auctions: [] });\n        }\n\n        let query = { \n            $text: { $search: q }\n        };\n\n        try{ \n            let barters = await Barter.find(query)\n                                    .populate('relatedCategory relatedUser')\n                                    .sort({ creationDate: -1 })\n                                    .limit(10);\n\n            let auctions = await Auction.find(query)\n                                    .populate('relatedCategory relatedUser')\n                                    .sort({ creationDate: -1})\n                                    .limit(10);\n            \n            barters = await checkAllMyOfferAndFavouriteIn(barters, req, true);\n            auctions = await checkAllMyOfferAndFavouriteIn(auctions, req, false);\n\n            res.status(200).send({ barters , auctions })\n            \n        } catch(err) {\n            next(err);\n        }\n\n    }\n}\n\n"]}